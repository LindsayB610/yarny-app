[build]
  command = "npm run build"
  publish = "dist"
  functions = "netlify/functions"

# FedCM web-identity file with proper headers
[[redirects]]
  from = "/.well-known/web-identity"
  to = "/.well-known/web-identity"
  status = 200
  force = true
  [redirects.headers]
    Access-Control-Allow-Origin = "*"
    Content-Type = "application/json"

# Redirect legacy vanilla HTML entry points to the React SPA
[[redirects]]
  from = "/editor.html"
  to = "/editor"
  status = 301

[[redirects]]
  from = "/stories.html"
  to = "/stories"
  status = 301

[[redirects]]
  from = "/docs.html"
  to = "/docs"
  status = 301

# Allow direct access to migration-plan.html (public, no auth required)
[[redirects]]
  from = "/migration-plan"
  to = "/migration-plan.html"
  status = 200

[[redirects]]
  from = "/migration-plan/testing-workbook"
  to = "/migration-plan/testing-workbook.html"
  status = 200

[[redirects]]
  from = "/migration-plan.html"
  to = "/migration-plan.html"
  status = 200

# Redirect deprecated /react paths to new SPA routes
[[redirects]]
  from = "/react/*"
  to = "/:splat"
  status = 301

# Legacy vanilla app access
[[redirects]]
  from = "/vanilla-app"
  to = "/stories"
  status = 301

[[redirects]]
  from = "/vanilla-app/*"
  to = "/stories"
  status = 301

# Catch-all for other routes (SPA fallback)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[build.environment]
  NODE_VERSION = "20"

[dev]
  command = "npm run dev"
  targetPort = 5173
  publish = "dist"
  framework = "vite"