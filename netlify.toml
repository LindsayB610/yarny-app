[build]
  command = "npm run build"
  publish = "dist"
  functions = "netlify/functions"

# FedCM web-identity file with proper headers
[[redirects]]
  from = "/.well-known/web-identity"
  to = "/.well-known/web-identity"
  status = 200
  force = true
  [redirects.headers]
    Access-Control-Allow-Origin = "*"
    Content-Type = "application/json"

# Allow direct access to editor.html and stories.html
[[redirects]]
  from = "/editor.html"
  to = "/editor.html"
  status = 200

[[redirects]]
  from = "/stories.html"
  to = "/stories.html"
  status = 200

# Allow direct access to migration-plan.html (public, no auth required)
[[redirects]]
  from = "/migration-plan"
  to = "/migration-plan.html"
  status = 200

[[redirects]]
  from = "/migration-plan.html"
  to = "/migration-plan.html"
  status = 200

# React app at /react path - must come before catch-all
[[redirects]]
  from = "/react/*"
  to = "/react/index.html"
  status = 200

# Catch-all for other routes (SPA fallback)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[build.environment]
  NODE_VERSION = "20"
