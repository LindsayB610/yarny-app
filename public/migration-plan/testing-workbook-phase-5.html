<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phase 5 · Yarny Testing Workbook</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="/global.css">
  <link rel="stylesheet" href="/docs.css">
  <link rel="stylesheet" href="/footer.css">
  <link rel="stylesheet" href="/migration-plan/testing-workbook.css">
  <script src="/migration-plan/testing-workbook.js" defer></script>
</head>
<body data-storage-key="testingWorkbookPhase5">
  <div class="docs-container">
    <main class="docs-main">
      <div class="sidebar-backdrop"></div>
      <aside class="docs-sidebar">
        <div class="sidebar-header">
          <div class="sidebar-branding">
            <h1>Yarny</h1>
            <p class="docs-subtitle">Your personal writing tool</p>
          </div>
          <a href="/migration-plan" style="color: var(--color-primary); text-decoration: none; font-weight: var(--font-weight-semibold); display: block; margin-bottom: var(--space-md);">
            Migration Plan
          </a>
          <a href="/migration-plan/testing-workbook" style="color: rgba(255, 255, 255, 0.7); text-decoration: none; font-size: 0.95rem; display: block;">Back to Workbook Overview</a>
        </div>
        <nav class="sidebar-nav">
          <ul class="sidebar-nav-list">
            <li><a href="#phase-intro" class="nav-link">Phase Overview</a></li>
            <li><a href="#section-15" class="nav-link">Section 15 · Notes CRUD</a></li>
            <li><a href="#section-16" class="nav-link">Section 16 · Visibility Gating</a></li>
            <li><a href="#section-17" class="nav-link">Section 17 · Rate Limiting</a></li>
            <li><a href="#section-18" class="nav-link">Section 18 · Visual Regression</a></li>
            <li><a href="#phase-summary" class="nav-link">Phase Progress</a></li>
          </ul>
        </nav>
      </aside>

      <div class="docs-content">
        <nav class="docs-nav">
          <a href="/stories.html" id="storiesNavLink" class="btn-secondary" style="display: none;">My Stories</a>
          <a href="/docs.html" class="btn-secondary">Docs</a>
          <a href="/" id="loginNavLink" class="btn-secondary">Back to Login</a>
        </nav>

        <div class="phase-breadcrumbs">
          <a href="/migration-plan/testing-workbook">Testing Workbook</a>
          <span>/</span>
          <span>Phase 5 · Reliability &amp; Visual QA</span>
        </div>

        <div class="workbook-intro" id="phase-intro" data-section-anchor>
          <h1>Phase 5 · Reliability &amp; Visual QA</h1>
          <p>Close out the migration with resilience checks, defensive UX behaviors, and strict visual parity against the legacy app.</p>
          <ul style="margin: var(--space-lg) 0 0; padding-left: var(--space-xl); color: rgba(255, 255, 255, 0.78);">
            <li>Exercise CRUD flows for notes to confirm normalized data handling.</li>
            <li>Validate visibility gating, performance protections, and rate limiting.</li>
            <li>Run visual regression suites plus manual review to certify parity.</li>
          </ul>
          <div class="phase-nav-links">
            <a href="/migration-plan/testing-workbook-phase-1.html">Phase 1</a>
            <a href="/migration-plan/testing-workbook-phase-2.html">Phase 2</a>
            <a href="/migration-plan/testing-workbook-phase-3.html">Phase 3</a>
            <a href="/migration-plan/testing-workbook-phase-4.html">Phase 4</a>
          </div>
        </div>

        <!-- Section 15: Notes CRUD Operations -->
        <div class="test-section" data-section-anchor id="section-15">
          <h2><i class="material-icons">note</i> Section 15: Notes CRUD Operations</h2>
          <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: var(--space-lg);">This section tests creating, reading, updating, and deleting notes in People, Places, and Things categories.</p>

          <div class="note-box" style="margin-bottom: var(--space-xl);">
            <p><strong>Prerequisites:</strong> Before starting, ensure:</p>
            <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl); color: rgba(255, 255, 255, 0.9);">
              <li>You have a story open in the editor</li>
              <li>Notes sidebar is visible (right sidebar)</li>
              <li>You can see People, Places, and Things tabs</li>
            </ul>
          </div>

          <h3>People Notes</h3>

          <div class="test-item">
            <h4>Test 15.1: Create People Note</h4>
            <p>Verify that creating a new note in People category works correctly.</p>
            <div class="test-steps">
              <ol>
                <li>Click on "People" tab in notes sidebar</li>
                <li>Click "New" or "+" button (or use keyboard shortcut)</li>
                <li>Enter a note name (e.g., "Alice Character")</li>
                <li>Enter note content (e.g., "Alice is a brave explorer with red hair.")</li>
                <li>Save the note</li>
                <li><strong>Verify in Yarny:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Note appears in People list</li>
                    <li>Note name is visible</li>
                    <li>Note content preview is visible (if shown)</li>
                  </ul>
                </li>
                <li><strong>Verify in Google Drive:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Open People folder in story folder</li>
                    <li>Text file with note name exists</li>
                    <li>File content matches what you entered</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="notes-15-1" name="notes-15-1">
              <label for="notes-15-1">People note creation works correctly</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 15.2: Read People Note</h4>
            <p>Verify that clicking a note opens it in the editor.</p>
            <div class="test-steps">
              <ol>
                <li>Click on a People note in the list</li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Note content appears in the main editor</li>
                    <li>Note name is shown (in editor header or title)</li>
                    <li>You can edit the content</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="notes-15-2" name="notes-15-2">
              <label for="notes-15-2">Reading People note works correctly</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 15.3: Update People Note</h4>
            <p>Verify that editing a note saves changes correctly.</p>
            <div class="test-steps">
              <ol>
                <li>Open a People note in the editor</li>
                <li>Make changes to the content (add or modify text)</li>
                <li>Wait for auto-save to complete</li>
                <li><strong>Verify in Yarny:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Save status shows "Saved"</li>
                    <li>Changes are preserved in editor</li>
                  </ul>
                </li>
                <li><strong>Refresh page</strong> - Reload Yarny</li>
                <li><strong>Verify persistence:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Changes are still present after refresh</li>
                  </ul>
                </li>
                <li><strong>Verify in Google Drive:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Open the note file in People folder</li>
                    <li>File content matches your edits</li>
                    <li>File modification time is recent</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="notes-15-3" name="notes-15-3">
              <label for="notes-15-3">Updating People note works correctly</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 15.4: Delete People Note</h4>
            <p>Verify that deleting a note removes it correctly.</p>
            <div class="test-steps">
              <ol>
                <li>Right-click on a People note (or use delete button)</li>
                <li>Select "Delete" option</li>
                <li>Confirm deletion</li>
                <li><strong>Verify in Yarny:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Note is removed from People list</li>
                    <li>Note no longer appears in sidebar</li>
                  </ul>
                </li>
                <li><strong>Verify in Google Drive:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Note file is deleted from People folder</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="notes-15-4" name="notes-15-4">
              <label for="notes-15-4">Deleting People note works correctly</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 15.5: Rename People Note</h4>
            <p>Verify that renaming a note updates the filename correctly.</p>
            <div class="test-steps">
              <ol>
                <li>Right-click on a People note (or double-click)</li>
                <li>Select "Rename" option</li>
                <li>Enter a new name (e.g., "Alice Smith" instead of "Alice")</li>
                <li>Save the rename</li>
                <li><strong>Verify in Yarny:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Note appears with new name in list</li>
                    <li>Note content is unchanged</li>
                  </ul>
                </li>
                <li><strong>Verify in Google Drive:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>File is renamed to new name</li>
                    <li>File content is unchanged</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="notes-15-5" name="notes-15-5">
              <label for="notes-15-5">Renaming People note works correctly</label>
            </div>
          </div>

          <h3>Places Notes</h3>

          <div class="test-item">
            <h4>Test 15.6: Create Places Note</h4>
            <p>Verify that creating a new note in Places category works correctly.</p>
            <div class="test-steps">
              <ol>
                <li>Click on "Places" tab in notes sidebar</li>
                <li>Click "New" or "+" button</li>
                <li>Enter a note name (e.g., "The Castle")</li>
                <li>Enter note content</li>
                <li>Save the note</li>
                <li><strong>Verify:</strong> Note appears in Places list and is saved to Google Drive Places folder</li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="notes-15-6" name="notes-15-6">
              <label for="notes-15-6">Places note creation works correctly</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 15.7: Update Places Note</h4>
            <p>Verify that editing a Places note saves correctly.</p>
            <div class="test-steps">
              <ol>
                <li>Open a Places note</li>
                <li>Make changes to content</li>
                <li>Wait for auto-save</li>
                <li><strong>Verify:</strong> Changes are saved and persist after refresh</li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="notes-15-7" name="notes-15-7">
              <label for="notes-15-7">Updating Places note works correctly</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 15.8: Delete Places Note</h4>
            <p>Verify that deleting a Places note works correctly.</p>
            <div class="test-steps">
              <ol>
                <li>Right-click on a Places note</li>
                <li>Select "Delete" and confirm</li>
                <li><strong>Verify:</strong> Note is removed from list and deleted from Google Drive</li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="notes-15-8" name="notes-15-8">
              <label for="notes-15-8">Deleting Places note works correctly</label>
            </div>
          </div>

          <h3>Things Notes</h3>

          <div class="test-item">
            <h4>Test 15.9: Create Things Note</h4>
            <p>Verify that creating a new note in Things category works correctly.</p>
            <div class="test-steps">
              <ol>
                <li>Click on "Things" tab in notes sidebar</li>
                <li>Click "New" or "+" button</li>
                <li>Enter a note name and content</li>
                <li>Save the note</li>
                <li><strong>Verify:</strong> Note appears in Things list and is saved to Google Drive Things folder</li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="notes-15-9" name="notes-15-9">
              <label for="notes-15-9">Things note creation works correctly</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 15.10: Switch Between People/Places/Things Tabs</h4>
            <p>Verify that switching between note category tabs works correctly.</p>
            <div class="test-steps">
              <ol>
                <li>Click on "People" tab</li>
                <li><strong>Verify:</strong> People notes are displayed</li>
                <li>Click on "Places" tab</li>
                <li><strong>Verify:</strong> Places notes are displayed</li>
                <li>Click on "Things" tab</li>
                <li><strong>Verify:</strong> Things notes are displayed</li>
                <li>Switch back to "People" tab</li>
                <li><strong>Verify:</strong> People notes are displayed again</li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="notes-15-10" name="notes-15-10">
              <label for="notes-15-10">Tab switching works correctly</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 15.11: Empty State Display</h4>
            <p>Verify that empty state message is shown when no notes exist.</p>
            <div class="test-steps">
              <ol>
                <li>Navigate to a category tab (People, Places, or Things) that has no notes</li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Empty state message is displayed (e.g., "No People notes yet. Create one to get started.")</li>
                    <li>Message is helpful and encourages action</li>
                    <li>New note button is still accessible</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="notes-15-11" name="notes-15-11">
              <label for="notes-15-11">Empty state is displayed correctly</label>
            </div>
          </div>
        </div>

        <!-- Section 16: Visibility Gating & Performance -->
        <div class="test-section" data-section-anchor id="section-16">
          <h2><i class="material-icons">visibility</i> Section 16: Visibility Gating & Performance</h2>
          <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: var(--space-lg);">This section tests lazy loading behavior, visibility-based request gating, and performance optimizations for large stories.</p>

          <div class="note-box" style="margin-bottom: var(--space-xl);">
            <p><strong>Prerequisites:</strong> Before starting, ensure:</p>
            <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl); color: rgba(255, 255, 255, 0.9);">
              <li>You have a story with many snippets (50+ for visibility gating tests)</li>
              <li>Browser DevTools Network tab is open to monitor requests</li>
              <li>You can monitor API calls and request patterns</li>
            </ul>
          </div>

          <div class="test-item">
            <h4>Test 16.1: Initial Load - Only Visible Snippets</h4>
            <p>Verify that only visible snippets are loaded initially, not all snippets.</p>
            <div class="test-steps">
              <ol>
                <li>Open a story with 50+ snippets</li>
                <li>Open Browser DevTools → Network tab</li>
                <li>Filter by "drive-read" or "drive-list" requests</li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Only first few snippets (3-5) trigger API requests</li>
                    <li>Not all 50+ snippets trigger requests immediately</li>
                    <li>Page loads quickly</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="vis-16-1" name="vis-16-1">
              <label for="vis-16-1">Only visible snippets are loaded initially</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 16.2: Load on Scroll</h4>
            <p>Verify that scrolling down triggers loading of additional snippets.</p>
            <div class="test-steps">
              <ol>
                <li>Open a story with 50+ snippets</li>
                <li>Open Browser DevTools → Network tab</li>
                <li>Scroll down in the sidebar to reveal more snippets</li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>New API requests are triggered as snippets become visible</li>
                    <li>Snippets load as they enter the viewport</li>
                    <li>Loading happens smoothly without blocking UI</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="vis-16-2" name="vis-16-2">
              <label for="vis-16-2">Scrolling triggers loading of additional snippets</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 16.3: Prefetch First Few Snippets</h4>
            <p>Verify that first 3 snippets are prefetched immediately for faster access.</p>
            <div class="test-steps">
              <ol>
                <li>Open a story with many snippets</li>
                <li>Open Browser DevTools → Network tab</li>
                <li>Monitor initial page load</li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>First 3 snippets trigger API requests immediately</li>
                    <li>Requests happen in parallel (not sequentially)</li>
                    <li>Snippets are ready when user navigates to them</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="vis-16-3" name="vis-16-3">
              <label for="vis-16-3">First few snippets are prefetched immediately</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 16.4: Click Snippet - Loads Even If Not Visible</h4>
            <p>Verify that clicking on a snippet loads it even if it's not currently visible.</p>
            <div class="test-steps">
              <ol>
                <li>Open a story with many snippets</li>
                <li>Scroll to a snippet that's not yet loaded (middle or end of list)</li>
                <li>Click on that snippet</li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Snippet content loads immediately</li>
                    <li>Editor displays snippet content</li>
                    <li>No error messages</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="vis-16-4" name="vis-16-4">
              <label for="vis-16-4">Clicking snippet loads it even if not visible</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 16.5: Request Throttling</h4>
            <p>Verify that rapid scrolling doesn't trigger excessive API requests.</p>
            <div class="test-steps">
              <ol>
                <li>Open a story with many snippets</li>
                <li>Open Browser DevTools → Network tab</li>
                <li>Scroll rapidly up and down multiple times</li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Requests are throttled/debounced</li>
                    <li>Not every scroll event triggers a new request</li>
                    <li>Total number of requests is reasonable (not 50+ for 50 snippets)</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="vis-16-5" name="vis-16-5">
              <label for="vis-16-5">Request throttling prevents excessive API calls</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 16.6: Performance with Large Story</h4>
            <p>Verify that large stories (100+ snippets) remain performant.</p>
            <div class="test-steps">
              <ol>
                <li>Open a story with 100+ snippets</li>
                <li>Measure initial page load time</li>
                <li>Scroll through the entire list</li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Page loads in reasonable time (&lt; 3 seconds)</li>
                    <li>Scrolling is smooth (no jank or lag)</li>
                    <li>Memory usage doesn't grow excessively</li>
                    <li>UI remains responsive</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="vis-16-6" name="vis-16-6">
              <label for="vis-16-6">Large stories remain performant</label>
            </div>
          </div>
        </div>

        <!-- Section 17: Rate Limiting & Error Handling -->
        <div class="test-section" data-section-anchor id="section-17">
          <h2><i class="material-icons">warning</i> Section 17: Rate Limiting & Error Handling</h2>
          <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: var(--space-lg);">This section tests how the app handles rate limiting (429 errors), retries, exponential backoff, and error recovery.</p>

          <div class="note-box" style="margin-bottom: var(--space-xl);">
            <p><strong>Note:</strong> These tests require simulating rate limiting scenarios. You may need to use browser DevTools or network throttling to simulate 429 responses, or coordinate with the development team to trigger rate limits in a test environment.</p>
          </div>

          <div class="test-item">
            <h4>Test 17.1: Retry on 429 Rate Limit</h4>
            <p>Verify that the app retries requests after receiving a 429 rate limit error.</p>
            <div class="test-steps">
              <ol>
                <li>Open Browser DevTools → Network tab</li>
                <li>Enable network throttling or use a tool to simulate 429 responses</li>
                <li>Perform an action that triggers an API request (e.g., switch snippets, save content)</li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Request receives 429 response</li>
                    <li>App automatically retries the request</li>
                    <li>Retry happens after a delay (exponential backoff)</li>
                    <li>Request eventually succeeds after retries</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="rate-17-1" name="rate-17-1">
              <label for="rate-17-1">App retries on 429 rate limit errors</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 17.2: Exponential Backoff</h4>
            <p>Verify that retry delays increase exponentially (e.g., 1s, 2s, 4s).</p>
            <div class="test-steps">
              <ol>
                <li>Simulate continuous 429 responses</li>
                <li>Monitor retry attempts in Network tab</li>
                <li>Measure time between retries</li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>First retry happens after ~1 second</li>
                    <li>Second retry happens after ~2 seconds</li>
                    <li>Third retry happens after ~4 seconds</li>
                    <li>Delays increase exponentially (or with jitter)</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="rate-17-2" name="rate-17-2">
              <label for="rate-17-2">Exponential backoff is implemented correctly</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 17.3: Respect Retry-After Header</h4>
            <p>Verify that the app respects the Retry-After header in 429 responses.</p>
            <div class="test-steps">
              <ol>
                <li>Simulate a 429 response with Retry-After: 5 header</li>
                <li>Monitor when the next retry occurs</li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>App waits at least 5 seconds before retrying</li>
                    <li>Retry-After value is respected (not ignored)</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="rate-17-3" name="rate-17-3">
              <label for="rate-17-3">Retry-After header is respected</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 17.4: Max Retries</h4>
            <p>Verify that the app stops retrying after maximum retry attempts.</p>
            <div class="test-steps">
              <ol>
                <li>Simulate continuous 429 responses (never succeed)</li>
                <li>Monitor retry attempts</li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>App retries up to maximum attempts (e.g., 3 retries)</li>
                    <li>After max retries, error is shown to user</li>
                    <li>No infinite retry loop occurs</li>
                    <li>User is informed of the error</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="rate-17-4" name="rate-17-4">
              <label for="rate-17-4">Max retries are enforced correctly</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 17.5: User-Friendly Error Messages</h4>
            <p>Verify that rate limiting errors are communicated clearly to users.</p>
            <div class="test-steps">
              <ol>
                <li>Trigger a rate limit scenario that fails after max retries</li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Error message is displayed to user</li>
                    <li>Message is user-friendly (not technical)</li>
                    <li>Message suggests what user can do (e.g., "Please try again in a moment")</li>
                    <li>UI remains functional (not broken)</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="rate-17-5" name="rate-17-5">
              <label for="rate-17-5">Error messages are user-friendly</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 17.6: Queued Operations During Rate Limiting</h4>
            <p>Verify that operations are queued and retried when rate limiting is resolved.</p>
            <div class="test-steps">
              <ol>
                <li>Trigger rate limiting</li>
                <li>While rate limited, perform multiple operations (switch snippets, save content)</li>
                <li>Allow rate limiting to resolve</li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Queued operations are retried automatically</li>
                    <li>All operations eventually complete</li>
                    <li>No operations are lost</li>
                    <li>Operations complete in correct order (if order matters)</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="rate-17-6" name="rate-17-6">
              <label for="rate-17-6">Queued operations are retried correctly</label>
            </div>
          </div>

          <div class="note-box" style="margin-top: var(--space-2xl);">
            <p><strong>Note:</strong> Rate limiting tests may require coordination with the development team or use of specialized testing tools. Some tests may need to be performed in a staging environment where rate limits can be controlled.</p>
          </div>
        </div>

        <!-- Section 18: Visual Regression Testing -->
        <div class="test-section" data-section-anchor id="section-18">
          <h2><i class="material-icons">compare</i> Section 18: Visual Regression Testing</h2>
          <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: var(--space-lg);">This section covers automated visual regression tests that compare the React app against the legacy app using pixel-diff comparison. These tests ensure visual parity between the two implementations.</p>

          <div class="note-box" style="margin-bottom: var(--space-xl);">
            <p><strong>Prerequisites:</strong></p>
            <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl); color: rgba(255, 255, 255, 0.9);">
              <li>React app must be deployed to <code>/react</code> path</li>
              <li>Legacy app must be accessible at root path</li>
              <li>Both apps must have the same test data loaded</li>
              <li>Development server running (<code>npm run dev</code>)</li>
            </ul>
          </div>

          <div class="test-item">
            <h4>Test 18.1: Run Automated Visual Regression Tests</h4>
            <p>Execute the automated visual regression test suite that compares React and legacy apps using pixel-diff comparison.</p>
            <div class="test-steps">
              <ol>
                <li>Open terminal in the project root directory</li>
                <li>Ensure development server is running: <code>npm run dev</code></li>
                <li>Run the visual regression tests: <code>npm run test:e2e -- tests/e2e/visual-regression.spec.ts</code></li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Tests execute successfully</li>
                    <li>Screenshots are captured for both React and legacy apps</li>
                    <li>Diff images are generated in <code>test-results/visual-regression/</code></li>
                    <li>Test results show pixel difference percentages</li>
                  </ul>
                </li>
                <li>Review test output for any failures or warnings</li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="test-18-1" name="test-18-1">
              <label for="test-18-1">Automated visual regression tests executed successfully</label>
            </div>
            <div class="note-box" style="margin-top: var(--space-md);">
              <p><strong>Expected Test Results:</strong></p>
              <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl); color: rgba(255, 255, 255, 0.9);">
                <li><strong>Goal Meter:</strong> Diff percentage ≤ 5%</li>
                <li><strong>Today Chip:</strong> Diff percentage ≤ 5%</li>
                <li><strong>Footer Counts:</strong> Diff percentage ≤ 5%</li>
                <li><strong>Stories Page:</strong> Diff percentage ≤ 10% (full page)</li>
                <li><strong>Editor Layout:</strong> Diff percentage ≤ 10% (full page)</li>
              </ul>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 18.2: Review Screenshots and Diff Images</h4>
            <p>Manually review the captured screenshots and generated diff images to verify visual parity and identify any visual differences.</p>
            <div class="test-steps">
              <ol>
                <li>Navigate to <code>test-results/visual-regression/</code> directory</li>
                <li>Review React app screenshots:
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li><code>react-goal-meter.png</code></li>
                    <li><code>react-today-chip.png</code></li>
                    <li><code>react-footer.png</code></li>
                    <li><code>react-stories-page.png</code></li>
                    <li><code>react-editor.png</code></li>
                  </ul>
                </li>
                <li>Review legacy app screenshots:
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li><code>legacy-goal-meter.png</code></li>
                    <li><code>legacy-today-chip.png</code></li>
                    <li><code>legacy-footer.png</code></li>
                    <li><code>legacy-stories-page.png</code></li>
                    <li><code>legacy-editor.png</code></li>
                  </ul>
                </li>
                <li>Review diff images (red/blue pixels indicate differences):
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li><code>diff-goal-meter.png</code></li>
                    <li><code>diff-today-chip.png</code></li>
                    <li><code>diff-footer.png</code></li>
                    <li><code>diff-stories-page.png</code></li>
                    <li><code>diff-editor.png</code></li>
                  </ul>
                </li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Diff images show minimal differences (mostly red/blue pixels in non-critical areas)</li>
                    <li>No major layout shifts or missing elements</li>
                    <li>Colors, fonts, and spacing match between React and legacy apps</li>
                    <li>Any differences are acceptable (document if not)</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="test-18-2" name="test-18-2">
              <label for="test-18-2">Screenshots and diff images reviewed, visual parity verified</label>
            </div>
            <div class="note-box" style="margin-top: var(--space-md);">
              <p><strong>Notes:</strong> Document any significant visual differences found. Red/blue pixels in diff images indicate where React and legacy apps differ. Minor differences in anti-aliasing or sub-pixel rendering are acceptable.</p>
              <textarea style="width: 100%; min-height: 80px; padding: var(--space-sm); border-radius: 4px; background: rgba(0, 0, 0, 0.3); color: rgba(255, 255, 255, 0.9); border: 1px solid rgba(255, 255, 255, 0.1); margin-top: var(--space-sm);" placeholder="Document any visual differences found..."></textarea>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 18.3: Verify Pixel-Diff Comparison Accuracy</h4>
            <p>Verify that the pixel-diff comparison is working correctly and accurately detecting visual differences.</p>
            <div class="test-steps">
              <ol>
                <li>Run visual regression tests: <code>npm run test:e2e -- tests/e2e/visual-regression.spec.ts</code></li>
                <li>Check test output for pixel difference statistics:
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Diff pixels count</li>
                    <li>Diff percentage</li>
                    <li>Test pass/fail status</li>
                  </ul>
                </li>
                <li><strong>Verify:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Tests report accurate pixel difference counts</li>
                    <li>Diff percentages are calculated correctly</li>
                    <li>Tests fail when differences exceed threshold (5% for components, 10% for full pages)</li>
                    <li>Diff images are generated for all comparisons</li>
                  </ul>
                </li>
                <li>If tests fail, review diff images to understand why</li>
                <li>If differences are acceptable, adjust thresholds or fix visual issues</li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="test-18-3" name="test-18-3">
              <label for="test-18-3">Pixel-diff comparison verified to be working correctly</label>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 18.4: Side-by-Side Manual Comparison</h4>
            <p>Perform manual side-by-side comparison of React and legacy apps in the browser to verify visual parity beyond automated tests.</p>
            <div class="test-steps">
              <ol>
                <li>Open two browser windows side-by-side</li>
                <li>In first window, navigate to React app: <code>http://localhost:5173/react/editor</code></li>
                <li>In second window, navigate to legacy app: <code>http://localhost:5173/editor.html</code></li>
                <li>Ensure both apps have the same story and snippet loaded</li>
                <li>Compare the following elements visually:
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li><strong>Goal Meter:</strong> Size, colors, progress bar, text alignment</li>
                    <li><strong>Today Chip:</strong> Size, colors, text, border, padding</li>
                    <li><strong>Footer Counts:</strong> Font size, spacing, alignment, colors</li>
                    <li><strong>Editor Layout:</strong> Overall layout, spacing, sidebar widths, header</li>
                    <li><strong>Stories Page:</strong> Card layout, spacing, colors, typography</li>
                  </ul>
                </li>
                <li>Take side-by-side screenshots if differences are found</li>
                <li>Document any visual differences that automated tests might have missed</li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="test-18-4" name="test-18-4">
              <label for="test-18-4">Side-by-side manual comparison completed, visual parity verified</label>
            </div>
            <div class="note-box" style="margin-top: var(--space-md);">
              <p><strong>Notes:</strong> Document any visual differences found during manual comparison. Include screenshots if significant differences are observed.</p>
              <textarea style="width: 100%; min-height: 80px; padding: var(--space-sm); border-radius: 4px; background: rgba(0, 0, 0, 0.3); color: rgba(255, 255, 255, 0.9); border: 1px solid rgba(255, 255, 255, 0.1); margin-top: var(--space-sm);" placeholder="Document any visual differences found during manual comparison..."></textarea>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 18.5: Fix Visual Differences</h4>
            <p>If visual regression tests reveal differences exceeding the 5% threshold, fix the visual issues in the React app to match the legacy app.</p>
            <div class="test-steps">
              <ol>
                <li><strong>Review diff images:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Open diff images in <code>test-results/visual-regression/</code></li>
                    <li>Red/blue pixels indicate where React and legacy apps differ</li>
                    <li>Identify which components have differences (goal meter, footer, etc.)</li>
                    <li>Note the type of differences (spacing, colors, fonts, layout)</li>
                  </ul>
                </li>
                <li><strong>Compare side-by-side screenshots:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Open React app screenshot (e.g., <code>react-goal-meter.png</code>)</li>
                    <li>Open legacy app screenshot (e.g., <code>legacy-goal-meter.png</code>)</li>
                    <li>Use image viewer to compare side-by-side</li>
                    <li>Identify specific visual differences (font size, spacing, colors, etc.)</li>
                  </ul>
                </li>
                <li><strong>Inspect React app component styles:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Open React app in browser: <code>http://localhost:5173/react/editor</code></li>
                    <li>Use browser dev tools to inspect the component with differences</li>
                    <li>Check computed styles (font-size, color, margin, padding, etc.)</li>
                    <li>Compare with legacy app styles (open <code>http://localhost:5173/editor.html</code>)</li>
                    <li>Note which CSS properties differ</li>
                  </ul>
                </li>
                <li><strong>Fix React component styles:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Locate the React component file (e.g., <code>src/components/story/GoalMeter.tsx</code>)</li>
                    <li>Update CSS/styling to match legacy app</li>
                    <li>Common fixes:
                      <ul style="margin-top: var(--space-xs); padding-left: var(--space-lg);">
                        <li>Font sizes: Match exact pixel values (e.g., <code>fontSize: '13px'</code>)</li>
                        <li>Colors: Match hex values (e.g., <code>color: '#6B7280'</code>)</li>
                        <li>Spacing: Match margin/padding values (e.g., <code>marginBottom: '12px'</code>)</li>
                        <li>Layout: Match flexbox/grid properties</li>
                        <li>Typography: Match font-family, font-weight, line-height</li>
                      </ul>
                    </li>
                    <li>Save changes and verify in browser</li>
                  </ul>
                </li>
                <li><strong>Re-run visual regression tests:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Run: <code>npm run test:e2e -- tests/e2e/visual-regression.spec.ts</code></li>
                    <li>Check if diff percentage decreased</li>
                    <li>Verify diff percentage is now ≤ 5% (for components) or ≤ 10% (for full pages)</li>
                    <li>If still above threshold, repeat steps 3-5</li>
                  </ul>
                </li>
                <li><strong>Document fixes:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Record which components were fixed</li>
                    <li>Note what changes were made (CSS properties updated)</li>
                    <li>Document final diff percentages after fixes</li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="test-18-5" name="test-18-5">
              <label for="test-18-5">Visual differences fixed, all tests pass with diff percentage ≤ 5%</label>
            </div>
            <div class="note-box" style="margin-top: var(--space-md);">
              <p><strong>Notes:</strong> Document which components were fixed and what changes were made.</p>
              <textarea style="width: 100%; min-height: 80px; padding: var(--space-sm); border-radius: 4px; background: rgba(0, 0, 0, 0.3); color: rgba(255, 255, 255, 0.9); border: 1px solid rgba(255, 255, 255, 0.1); margin-top: var(--space-sm);" placeholder="Document fixes made: component name, CSS properties updated, final diff percentage..."></textarea>
            </div>
          </div>

          <div class="test-item">
            <h4>Test 18.6: Update Visual Regression Baselines</h4>
            <p>If visual differences are intentional (e.g., design improvements), update the visual regression baselines to reflect the new expected appearance.</p>
            <div class="test-steps">
              <ol>
                <li><strong>Verify differences are intentional:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Review diff images to confirm differences are intentional design changes</li>
                    <li>Document why the change was made (design improvement, accessibility, etc.)</li>
                    <li>Get approval if needed (for significant visual changes)</li>
                    <li>Ensure changes don't break accessibility or usability</li>
                  </ul>
                </li>
                <li><strong>Update Playwright screenshot baselines:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Playwright uses <code>toHaveScreenshot()</code> which automatically updates baselines</li>
                    <li>To update baselines, run: <code>npm run test:e2e -- tests/e2e/visual-regression.spec.ts -- --update-snapshots</code> (Note: double dashes are required to pass flags to Playwright)</li>
                    <li>This updates the baseline screenshots in <code>tests/e2e/visual-regression.spec.ts-snapshots/</code></li>
                    <li>Verify new baseline screenshots match current React app appearance</li>
                  </ul>
                </li>
                <li><strong>Update pixel-diff comparison thresholds (if needed):</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>If intentional changes cause higher diff percentages, adjust thresholds in test file</li>
                    <li>Open <code>tests/e2e/visual-regression.spec.ts</code></li>
                    <li>Find <code>maxDiffPercentage</code> constant (line ~174)</li>
                    <li>Update threshold if needed (default is 5% for components, 10% for full pages)</li>
                    <li>Document why threshold was changed</li>
                  </ul>
                </li>
                <li><strong>Update legacy app screenshots (if legacy app changed):</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>If legacy app was updated to match React app, update legacy screenshots</li>
                    <li>Re-run tests to capture new legacy app appearance</li>
                    <li>Verify both React and legacy screenshots are up to date</li>
                  </ul>
                </li>
                <li><strong>Re-run visual regression tests:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Run: <code>npm run test:e2e -- tests/e2e/visual-regression.spec.ts</code></li>
                    <li>Verify all tests pass with updated baselines</li>
                    <li>Check that diff percentages are within acceptable thresholds</li>
                  </ul>
                </li>
                <li><strong>Commit baseline updates:</strong>
                  <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl);">
                    <li>Commit updated baseline screenshots to version control</li>
                    <li>Include commit message explaining why baselines were updated</li>
                    <li>Example: <code>git commit -m "Update visual regression baselines for intentional design changes"</code></li>
                  </ul>
                </li>
              </ol>
            </div>
            <div class="checkbox-container">
              <input type="checkbox" id="test-18-6" name="test-18-6">
              <label for="test-18-6">Visual regression baselines updated for intentional changes, all tests pass</label>
            </div>
            <div class="note-box" style="margin-top: var(--space-md);">
              <p><strong>Important:</strong> Only update baselines for intentional design changes. If differences are bugs, fix them instead of updating baselines.</p>
              <p style="margin-top: var(--space-sm);"><strong>Notes:</strong> Document which baselines were updated and why.</p>
              <textarea style="width: 100%; min-height: 80px; padding: var(--space-sm); border-radius: 4px; background: rgba(0, 0, 0, 0.3); color: rgba(255, 255, 255, 0.9); border: 1px solid rgba(255, 255, 255, 0.1); margin-top: var(--space-sm);" placeholder="Document baseline updates: which components changed, why (design improvement, accessibility, etc.), threshold adjustments..."></textarea>
            </div>
          </div>

          <div class="note-box" style="margin-top: var(--space-2xl);">
            <p><strong>Visual Regression Testing Summary:</strong></p>
            <ul style="margin-top: var(--space-sm); padding-left: var(--space-xl); color: rgba(255, 255, 255, 0.9);">
              <li><strong>Automated Tests Executed:</strong> [ ] ✅ PASS / [ ] ❌ FAIL</li>
              <li><strong>Screenshots Reviewed:</strong> [ ] ✅ PASS / [ ] ❌ FAIL</li>
              <li><strong>Diff Images Generated:</strong> [ ] ✅ PASS / [ ] ❌ FAIL</li>
              <li><strong>Pixel-Diff Comparison Verified:</strong> [ ] ✅ PASS / [ ] ❌ FAIL</li>
              <li><strong>Manual Side-by-Side Comparison:</strong> [ ] ✅ PASS / [ ] ❌ FAIL</li>
              <li><strong>Visual Differences Fixed:</strong> [ ] ✅ PASS / [ ] ❌ FAIL / [ ] N/A (no differences)</li>
              <li><strong>Baselines Updated:</strong> [ ] ✅ PASS / [ ] ❌ FAIL / [ ] N/A (no intentional changes)</li>
              <li><strong>Overall Visual Parity:</strong> [ ] ✅ PASS / [ ] ❌ FAIL</li>
            </ul>
            <p style="margin-top: var(--space-md);"><strong>Note:</strong> Visual regression tests ensure that the React app maintains visual parity with the legacy app. All tests should pass before considering the migration complete.</p>
          </div>
        </div>

        <div class="summary-section" id="phase-summary" data-section-anchor>
          <h2>Phase 5 Progress</h2>
          <p style="color: rgba(255, 255, 255, 0.78); margin-bottom: var(--space-xl);">Phase 5 wraps the migration. Confirm everything here before signing off.</p>
          <div class="summary-stats">
            <div class="stat-box">
              <div class="stat-number" id="totalTests">0</div>
              <div class="stat-label">Total Tasks</div>
            </div>
            <div class="stat-box">
              <div class="stat-number" id="completedTests">0</div>
              <div class="stat-label">Completed</div>
            </div>
            <div class="stat-box">
              <div class="stat-number" id="remainingTests">0</div>
              <div class="stat-label">Remaining</div>
            </div>
            <div class="stat-box">
              <div class="stat-number" id="completionPercent">0%</div>
              <div class="stat-label">Completion</div>
            </div>
          </div>
        </div>

        <div class="note-box" style="margin-top: var(--space-4xl);">
          <p><strong>Note:</strong> This testing workbook is designed to be comprehensive. You don't need to complete all tests in one session. Work through them systematically, and note any issues or unexpected behavior you encounter. Report any bugs or problems to the development team.</p>
        </div>
      </div>
    </main>

    <footer class="shared-footer">
      <p>&copy; 2025 Yarny. Your personal writing tool.</p>
      <nav class="shared-footer-nav">
        <a href="/docs.html">User Guide</a>
        <a href="/migration-plan">Migration Plan</a>
        <a href="/migration-plan/testing-workbook">Testing Workbook</a>
      </nav>
    </footer>
  </div>
</body>
</html>
