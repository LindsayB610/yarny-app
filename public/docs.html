<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yarny - User Guide</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="/global.css">
  <link rel="stylesheet" href="/docs.css">
  <!-- Privacy-friendly analytics by Plausible -->
  <script async src="https://plausible.io/js/pa-hQCYhFM-nW3tbKDHDR8Xc.js"></script>
  <script>
    window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
    plausible.init()
  </script>
</head>
<body>
  <div class="docs-container">
    <header class="docs-header">
      <div class="docs-header-content">
        <div>
          <h1>Yarny</h1>
          <p class="docs-subtitle">User Guide & Documentation</p>
        </div>
        <nav class="docs-nav">
          <a href="/stories.html" id="storiesNavLink" class="btn-secondary" style="display: none;">My Stories</a>
          <a href="/" id="loginNavLink" class="btn-secondary">Back to Login</a>
        </nav>
      </div>
    </header>

    <main class="docs-main">
      <div class="sidebar-backdrop"></div>
      <aside class="docs-sidebar">
        <div class="sidebar-header">
          <div class="status-indicator" id="statusIndicator">
            <span class="status-dot" id="statusDot"></span>
            <span class="status-text" id="statusText">Checking status...</span>
          </div>
        </div>
        <nav class="sidebar-nav">
          <ul class="sidebar-nav-list">
            <li><a href="#getting-started" class="nav-link">Getting Started</a></li>
            <li><a href="#creating-and-managing-stories" class="nav-link">Creating and Managing Stories</a></li>
            <li><a href="#writing-in-the-editor" class="nav-link">Writing in the Editor</a></li>
            <li><a href="#people-places-things" class="nav-link">People, Places, and Things</a></li>
            <li><a href="#word-count-goals" class="nav-link">Word Count and Goals</a></li>
            <li><a href="#google-drive-integration" class="nav-link">Google Drive Integration</a></li>
            <li><a href="#troubleshooting" class="nav-link">Troubleshooting</a></li>
            <li><a href="#keyboard-shortcuts" class="nav-link">Keyboard Shortcuts</a></li>
            <li><a href="#error-codes-debugging" class="nav-link">Error Codes and Debugging</a></li>
            <li><a href="#tips-best-practices" class="nav-link">Tips and Best Practices</a></li>
            <li><a href="#getting-help" class="nav-link">Getting Help</a></li>
          </ul>
        </nav>
      </aside>

      <div class="docs-content">
        <section class="docs-section" style="background: #FEF3C7; border-left: 4px solid #F59E0B; padding: var(--space-lg); margin-bottom: var(--space-2xl); border-radius: var(--radius-lg);">
          <h2 style="margin-top: 0; color: #92400E; display: flex; align-items: center; gap: 8px;">
            <i class="material-icons" style="font-size: 24px;">warning</i>
            Yarny is Currently in Alpha
          </h2>
          <p style="margin-bottom: 0; color: #78350F;"><strong style="color: #78350F;">Note:</strong> Yarny is currently in alpha testing. Features may change, and there may be bugs or incomplete functionality. Please report any issues you encounter.</p>
        </section>

        <section class="docs-section" id="getting-started">
          <h2>Getting Started</h2>
          <p>Yarny is a writing tool designed to help you organize and manage your writing projects. Your stories are automatically saved to your Google Drive, so you can access them from anywhere.</p>

          <h3>Account Creation & Access</h3>
          <p><strong>Yarny requires an invitation to use.</strong> To request access, please email <a href="mailto:lb@lindsaybrunner.com">lb@lindsaybrunner.com</a> with your Google account email address.</p>
          
          <p>Once you've been granted access, you can sign in:</p>

          <h3>Signing In</h3>
          <p>To get started with Yarny:</p>
          <ol>
            <li>Click "Sign in with Google" on the login page</li>
            <li>Authorize Yarny to access your Google account</li>
            <li>Connect your Google Drive when prompted</li>
            <li>Start creating your first story!</li>
          </ol>
        </section>

        <section class="docs-section" id="creating-and-managing-stories">
          <h2>Creating and Managing Stories</h2>
          
          <h3>Creating a New Story</h3>
          <ol>
            <li>From the Stories page, click the "+ New Story" button</li>
            <li>Enter a name for your story</li>
            <li>Click "Create Story"</li>
          </ol>
          <p>Your story will be created in a folder on your Google Drive called "Yarny Stories".</p>

          <h3>Opening a Story</h3>
          <p>Simply click on any story card from the Stories page to open it in the editor. The editor automatically opens to the snippet you were last editing, whether that's in a chapter or in People/Places/Things, so you can pick up exactly where you left off.</p>

          <h3>Deleting a Story</h3>
          <ol>
            <li>Click the "×" button on a story card</li>
            <li>Type "DELETE" to confirm</li>
            <li>Choose whether to permanently delete from Drive or move to trash</li>
            <li>Click "Delete Story"</li>
          </ol>
        </section>

        <section class="docs-section" id="writing-in-the-editor">
          <h2>Writing in the Editor</h2>
          
          <h3>Editor Interface</h3>
          <p>The editor has three main areas:</p>
          <ul>
            <li><strong>Left Rail (Story)</strong>: Your story structure with chapters, groups, and snippets</li>
            <li><strong>Center Canvas</strong>: The main writing area where you compose your content - all snippets open here</li>
            <li><strong>Right Rail (Snippets)</strong>: Your snippets organized by People, Places, and Things</li>
          </ul>
          <p><strong>Resume Where You Left Off:</strong> When you open a story, the editor automatically opens to the snippet you were last editing, whether it's in a chapter or in People/Places/Things. This makes it easy to continue your work without having to navigate to find where you were.</p>

          <h3>Organizing Your Story</h3>
          <p>Yarny uses a flexible structure:</p>
          <ul>
            <li><strong>Groups</strong>: Major sections or chapters of your story</li>
            <li><strong>Snippets</strong>: Individual pieces of writing within a group</li>
          </ul>

          <h3>Chapter Color Coding</h3>
          <p>You can color-code your chapters to visually organize your story:</p>
          <ol>
            <li>Click the small colored square next to a chapter title</li>
            <li>A color picker will appear with 12 accent colors to choose from</li>
            <li>Select a color to apply it to that chapter</li>
            <li>The color is saved automatically and helps you visually distinguish between chapters</li>
          </ol>
          <p><strong>Tip:</strong> Use different colors to represent different story arcs, character perspectives, or time periods.</p>

          <h3>Adding Content</h3>
          <ol>
            <li>Click on a snippet or group to select it</li>
            <li>Start typing in the center editor</li>
            <li>Your changes are automatically saved to Google Drive</li>
          </ol>

          <h3>Creating New Snippets</h3>
          <p>There are two types of snippets:</p>
          <ul>
            <li><strong>Chapter Snippets</strong>: Click the "+" button next to a group header to add a new snippet to that chapter. <strong>New snippets appear instantly</strong> - you can start typing right away while the Drive file is created in the background.</li>
            <li><strong>People/Places/Things Snippets</strong>: Click the "+ New Snippet" button in the right rail (or the "+" button in the tab header) to create a new snippet in the People, Places, or Things category.</li>
          </ul>
          <p>All snippets open in the main editor window, providing a consistent editing experience. Your changes are automatically saved when you switch between snippets.</p>

          <h3>Creating New Chapters</h3>
          <p>Click the "New Chapter" button at the bottom of the story list to create a new group. New chapters are automatically assigned a color, but you can change it using the color picker.</p>

          <h3>Reordering Chapters and Snippets</h3>
          <p>You can reorganize your story by dragging chapters and snippets:</p>
          <ul>
            <li><strong>Reorder Chapters:</strong> Click and drag a chapter header to move it to a new position. The new order is automatically saved to Google Drive.</li>
            <li><strong>Reorder Snippets:</strong> Click and drag a snippet within a chapter to reorder it, or drag it to a different chapter to move it. Changes are saved automatically.</li>
          </ul>
          <p><strong>Tip:</strong> When dragging, you'll see visual feedback highlighting valid drop targets. The order is saved automatically, so your organization persists across sessions.</p>

          <h3>Collapsing and Expanding Chapters</h3>
          <p>To focus on specific chapters while working, you can collapse chapters you're not currently using:</p>
          <ol>
            <li>Click the collapse/expand button (arrow icon) on any chapter header</li>
            <li>The chapter will minimize, hiding its snippets</li>
            <li>Click again to expand and show the snippets</li>
          </ol>
          <p><strong>Benefits:</strong> Collapse chapters 1, 2, and 3 while working on chapter 4 to reduce visual clutter. Your collapsed preferences are remembered when you return to the story.</p>
        </section>

        <section class="docs-section" id="searching">
          <h2>Searching</h2>
          
          <p>Use the search box in the left rail to quickly find snippets by name or content. The search feature searches across all snippet titles and content, making it easy to find what you're looking for.</p>
        </section>

        <section class="docs-section" id="people-places-things">
          <h2>People, Places, and Things Snippets</h2>
          
          <h3>Snippet Categories</h3>
          <p>The right rail has three tabs for organizing snippets:</p>
          <ul>
            <li><strong>People</strong>: Character notes, relationships, descriptions</li>
            <li><strong>Places</strong>: Location descriptions, settings, world-building details</li>
            <li><strong>Things</strong>: Objects, items, concepts, and other elements</li>
          </ul>

          <h3>Creating and Editing Snippets</h3>
          <ol>
            <li>Click on a snippet in the right rail to open it in the main editor</li>
            <li>Or click "+ New Snippet" to create a new snippet in the current category</li>
            <li>Type your content in the main editor window</li>
            <li>Snippets are automatically saved when you switch between them</li>
            <li>All snippets work the same way - whether they're in chapters or People/Places/Things</li>
          </ol>
          <p><strong>Note:</strong> All snippets (chapters and People/Places/Things) now open in the main editor window for a consistent editing experience. Your changes are automatically saved in the background when you switch between snippets.</p>
        </section>

        <section class="docs-section" id="word-count-goals">
          <h2>Word Count and Goals</h2>
          
          <p>The left rail shows your current word count progress toward your writing goal. The goal meter helps you track your daily or project writing targets.</p>
          
          <h3>Editing Your Word Count Goal</h3>
          <p>To change your word count goal:</p>
          <ol>
            <li>Click on the goal meter in the left rail (shows "X / Y" where Y is your goal)</li>
            <li>This opens the Story Info & Settings modal</li>
            <li>Enter your desired word count goal in the "Word Count Goal" field</li>
            <li>Click "Save" to update your goal</li>
          </ol>
          <p>You can also access this by clicking the settings icon (⚙️) next to the "Story" title in the left rail.</p>
          
          <p>The footer shows:</p>
          <ul>
            <li>Current word count for the active snippet</li>
            <li>Character count for the active snippet</li>
            <li>Last modified timestamp</li>
          </ul>
        </section>

        <section class="docs-section" id="google-drive-integration">
          <h2>Google Drive Integration</h2>
          
          <h3>Automatic Saving</h3>
          <p>All your work is automatically saved to Google Drive. You'll see a "Saving..." or "Saved" indicator in the editor when changes are being synced.</p>

          <h3>Accessing Your Files</h3>
          <p>Your stories are stored in a folder called "Yarny Stories" in your Google Drive. You can access these files directly through Google Drive if needed.</p>

          <h3>Refreshing from Drive</h3>
          <p>Click the "↻ Refresh" button on the Stories page to sync any changes made outside of Yarny.</p>
        </section>

        <section class="docs-section" id="troubleshooting">
          <h2>Troubleshooting</h2>
          
          <h3>Authentication Issues</h3>
          <p>If you're having trouble signing in:</p>
          <ul>
            <li>Make sure you're using a Google account</li>
            <li>Check that cookies are enabled in your browser</li>
            <li>Try signing out and signing back in</li>
            <li>Clear your browser cache if problems persist</li>
          </ul>

          <h3>Drive Connection Issues</h3>
          <p>If Yarny can't access your Google Drive:</p>
          <ul>
            <li>Make sure you've authorized Yarny to access Google Drive</li>
            <li>Click "Connect to Drive" if you see the prompt</li>
            <li>Check that you have storage space available in your Google Drive</li>
          </ul>

          <h3>Sync Issues</h3>
          <p>If your changes aren't saving:</p>
          <ul>
            <li>Check your internet connection</li>
            <li>Look for the "Saving..." or "Saved" indicator in the editor</li>
            <li>Try refreshing the page</li>
            <li>Check your browser's console for error messages</li>
          </ul>
        </section>

        <section class="docs-section" id="keyboard-shortcuts">
          <h2>Keyboard Shortcuts</h2>
          
          <p>Yarny supports the following keyboard shortcuts to help you work more efficiently:</p>
          
          <table>
            <thead>
              <tr>
                <th>Shortcut</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>Cmd/Ctrl + N</code></td>
                <td>Create a new snippet in the current context</td>
              </tr>
              <tr>
                <td><code>Cmd/Ctrl + Shift + N</code></td>
                <td>Create a new chapter/group</td>
              </tr>
              <tr>
                <td><code>Cmd/Ctrl + F</code></td>
                <td>Focus the search box</td>
              </tr>
              <tr>
                <td><code>Esc</code></td>
                <td>Toggle focus mode (fade/show sidebars)</td>
              </tr>
            </tbody>
          </table>
          
          <p><strong>Note:</strong> On Mac, use <code>Cmd</code> instead of <code>Ctrl</code>. On Windows and Linux, use <code>Ctrl</code>.</p>
        </section>

        <section class="docs-section" id="error-codes-debugging">
          <h2>Error Codes and Debugging</h2>
          
          <p>Yarny includes built-in error logging to help diagnose issues. If you encounter problems, you can access error logs through your browser's developer console.</p>
          
          <h3>Accessing Error Logs</h3>
          <ol>
            <li>Open your browser's developer console (usually <code>F12</code> or <code>Cmd/Ctrl + Shift + I</code>)</li>
            <li>Type <code>viewYarnyErrors()</code> and press Enter</li>
            <li>A table of recent errors will be displayed, including timestamps, error types, and messages</li>
          </ol>
          
          <h3>Error Types</h3>
          <p>Yarny logs the following types of errors:</p>
          <ul>
            <li><strong>console.error</strong>: Errors logged via console.error() - typically application errors</li>
            <li><strong>unhandledrejection</strong>: Unhandled promise rejections - async operation failures</li>
            <li><strong>error</strong>: Global JavaScript errors - runtime exceptions</li>
          </ul>
          
          <h3>Clearing Error Logs</h3>
          <p>To clear the error log, type <code>clearYarnyErrors()</code> in the browser console.</p>
          
          <h3>Common Error Scenarios</h3>
          <ul>
            <li><strong>Drive API errors</strong>: Usually indicate authentication or permission issues with Google Drive</li>
            <li><strong>Network errors</strong>: Connection issues preventing saves to Drive</li>
            <li><strong>File not found errors</strong>: May occur if files were moved or deleted outside of Yarny</li>
            <li><strong>Conflict detection errors</strong>: Occurs when files are modified in Drive while being edited in Yarny</li>
          </ul>
          
          <p><strong>Tip:</strong> If you're reporting a bug, include the error log output from <code>viewYarnyErrors()</code> to help developers diagnose the issue.</p>
        </section>

        <section class="docs-section" id="tips-best-practices">
          <h2>Tips and Best Practices</h2>
          
          <ul>
            <li><strong>Color-code your chapters</strong>: Use the color picker to visually organize different story elements</li>
            <li><strong>Keep snippets updated</strong>: Regular snippet creation helps maintain consistency in your writing</li>
            <li><strong>Use groups for major sections</strong>: Organize your story into logical chapters or parts</li>
            <li><strong>Collapse chapters to focus</strong>: Use the collapse feature to minimize chapters you're not working on and reduce visual clutter</li>
            <li><strong>Create snippets freely</strong>: Don't worry about waiting - new snippets appear instantly so you can keep your flow</li>
            <li><strong>Switch between snippets freely</strong>: Your changes are automatically saved when switching, so you can move at your own pace</li>
            <li><strong>All snippets work the same</strong>: Whether they're in chapters or People/Places/Things, all snippets open in the main editor</li>
            <li><strong>Set writing goals</strong>: Use the goal meter to track your progress and stay motivated</li>
            <li><strong>Use keyboard shortcuts</strong>: Learn the keyboard shortcuts to speed up your workflow</li>
          </ul>
        </section>

        <section class="docs-section" id="getting-help">
          <h2>Getting Help</h2>
          <p>If you need additional help or encounter issues not covered in this guide:</p>
          <ul>
            <li>Check the troubleshooting section above for common issues</li>
            <li>Use the error logging feature (see "Error Codes and Debugging" section) to gather information about any errors</li>
            <li>Contact support at <a href="mailto:lb@lindsaybrunner.com">lb@lindsaybrunner.com</a> for assistance</li>
          </ul>
          <p>When reporting issues, please include:</p>
          <ul>
            <li>Description of the problem</li>
            <li>Steps to reproduce (if applicable)</li>
            <li>Error log output from <code>viewYarnyErrors()</code> if available</li>
            <li>Browser and operating system information</li>
          </ul>
        </section>
      </div>
    </main>

    <footer class="docs-footer">
      <p>&copy; 2025 Yarny. Your personal writing tool.</p>
      <nav class="docs-footer-nav">
        <a href="/stories.html" id="footerStoriesLink" style="display: none;">My Stories</a>
        <a href="/" id="footerLoginLink">Back to Login</a>
      </nav>
    </footer>
  </div>
  <script>
    // Check if user is logged in
    function isTokenExpired(token) {
      if (!token) return true;
      
      try {
        const decoded = atob(token);
        const parts = decoded.split(':');
        
        if (parts.length !== 2) return true;
        
        const timestamp = parseInt(parts[1], 10);
        if (isNaN(timestamp)) return true;
        
        // Check if token is within 48 hours
        const SESSION_DURATION_MS = 48 * 60 * 60 * 1000;
        const now = Date.now();
        const age = now - timestamp;
        
        return age > SESSION_DURATION_MS;
      } catch (error) {
        console.error('Error checking token expiration:', error);
        return true;
      }
    }

    function checkAuthStatus() {
      const authToken = localStorage.getItem('yarny_auth');
      const isLoggedIn = authToken && !isTokenExpired(authToken);
      
      const storiesLink = document.getElementById('storiesNavLink');
      const loginLink = document.getElementById('loginNavLink');
      const footerStoriesLink = document.getElementById('footerStoriesLink');
      const footerLoginLink = document.getElementById('footerLoginLink');
      
      if (isLoggedIn) {
        if (storiesLink) storiesLink.style.display = 'inline-block';
        if (loginLink) loginLink.style.display = 'none';
        if (footerStoriesLink) footerStoriesLink.style.display = 'inline-block';
        if (footerLoginLink) footerLoginLink.style.display = 'none';
      } else {
        if (storiesLink) storiesLink.style.display = 'none';
        if (loginLink) loginLink.style.display = 'inline-block';
        if (footerStoriesLink) footerStoriesLink.style.display = 'none';
        if (footerLoginLink) footerLoginLink.style.display = 'inline-block';
      }
    }

    // Highlight active navigation item based on scroll position
    document.addEventListener('DOMContentLoaded', function() {
      // Check auth status on page load
      checkAuthStatus();
      
      // Fetch and display Uptime Robot status
      async function fetchStatus() {
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        
        try {
          const response = await fetch('/.netlify/functions/uptime-status');
          const data = await response.json();
          
          // Log for debugging
          if (data.error || data.status === 'unknown') {
            console.log('Status check result:', data);
          }
          
          // Update dot color
          statusDot.className = 'status-dot';
          if (data.status === 'up') {
            statusDot.classList.add('status-green');
            statusText.textContent = 'All Systems Operational';
          } else if (data.status === 'warning') {
            statusDot.classList.add('status-yellow');
            statusText.textContent = 'Possible Issues';
          } else if (data.status === 'down') {
            statusDot.classList.add('status-red');
            statusText.textContent = 'Service Down';
          } else {
            statusDot.classList.add('status-gray');
            statusText.textContent = data.label || 'Status Unknown';
          }
        } catch (error) {
          console.error('Error fetching status:', error);
          statusDot.className = 'status-dot status-gray';
          statusText.textContent = 'Status Unavailable';
        }
      }
      
      // Fetch status on load and every 5 minutes
      fetchStatus();
      setInterval(fetchStatus, 5 * 60 * 1000);
      
      const navLinks = document.querySelectorAll('.sidebar-nav .nav-link');
      const sections = document.querySelectorAll('.docs-section[id]');
      const sidebar = document.querySelector('.docs-sidebar');
      const header = document.querySelector('.docs-header');

      function updateActiveNav() {
        let current = '';
        const scrollPos = window.scrollY + 150; // Offset for header

        sections.forEach(section => {
          const sectionTop = section.offsetTop;
          const sectionHeight = section.offsetHeight;
          if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight) {
            current = section.getAttribute('id');
          }
        });

        navLinks.forEach(link => {
          link.classList.remove('active');
          if (link.getAttribute('href') === '#' + current) {
            link.classList.add('active');
          }
        });
      }

      // Mobile menu toggle
      const menuButton = document.querySelector('.mobile-menu-toggle') || document.createElement('button');
      const backdrop = document.querySelector('.sidebar-backdrop');
      
      if (!menuButton.parentNode) {
        menuButton.className = 'mobile-menu-toggle';
        menuButton.innerHTML = '☰';
        menuButton.setAttribute('aria-label', 'Toggle menu');
        header.appendChild(menuButton);
      }

      function toggleSidebar() {
        sidebar.classList.toggle('open');
        if (backdrop) {
          backdrop.classList.toggle('active');
        }
      }

      menuButton.addEventListener('click', function(e) {
        e.stopPropagation();
        toggleSidebar();
      });

      // Close sidebar when clicking backdrop
      if (backdrop) {
        backdrop.addEventListener('click', function() {
          sidebar.classList.remove('open');
          backdrop.classList.remove('active');
        });
      }

      // Close sidebar when clicking outside on mobile
      document.addEventListener('click', function(e) {
        if (window.innerWidth <= 1024 && sidebar && sidebar.classList.contains('open')) {
          if (!sidebar.contains(e.target) && !e.target.classList.contains('mobile-menu-toggle')) {
            sidebar.classList.remove('open');
            if (backdrop) {
              backdrop.classList.remove('active');
            }
          }
        }
      });

      // Close sidebar when clicking a nav link on mobile
      navLinks.forEach(link => {
        link.addEventListener('click', function() {
          if (window.innerWidth <= 1024) {
            sidebar.classList.remove('open');
            if (backdrop) {
              backdrop.classList.remove('active');
            }
          }
        });
      });

      window.addEventListener('scroll', updateActiveNav);
      window.addEventListener('resize', function() {
        if (window.innerWidth > 1024) {
          sidebar.classList.remove('open');
          if (backdrop) {
            backdrop.classList.remove('active');
          }
        }
      });

      updateActiveNav(); // Initial call
    });
  </script>
</body>
</html>

